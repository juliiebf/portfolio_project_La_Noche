<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accueil - La Noche Karaoké Paris 9ème</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Reprends ici les styles communs de reservation.html */
    /* Bouton connexion */
    a.login-btn {
      background-color: #27a2ef; color: black; padding: 0.5rem 1.2rem; font-weight: 700;
      border-radius: 25px; border: none; text-decoration: none; cursor: pointer;
    }
    a.login-btn:hover {
      background-color: #009bdd; color: white;
    }
    main {
      max-width: 600px; margin: 3rem auto; padding: 0 1rem; text-align: center;
    }
    /* Popup modale connexions onglets */
    .modal-bg {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000;
    }
    .modal-popup {
      background: #222; padding: 2rem; border-radius: 10px; width: 360px; color: #eee;
    }
    .modal-tabs {
      display: flex; margin-bottom: 1rem;
    }
    .tab-btn {
      flex: 1; cursor: pointer; background: #333; border: none; padding: 0.8rem;
      color: #ccc; font-weight: 700;
    }
    .tab-btn.active {
      background: #27a2ef; color: black;
    }
    .modal-btn-main {
      width: 100%; background-color: #27a2ef; color: black; font-weight: 700;
      border: none; padding: 1rem; border-radius: 25px; cursor: pointer; font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="background"></div>
  <header>
    <div class="top-header">
      <a href="index.html">
        <img src="images/Design sans titre.png" alt="La Noche Karaoke - Bannière" class="logo-main" />
      </a>
      <nav class="main-nav">
        <ul class="nav-links">
          <li><a href="index.html" class="active">Accueil</a></li>
          <li><a href="reservation.html">Réservation</a></li>
          <li><a href="boissons.html">Boissons</a></li>
          <li><a href="chansons.html">Chansons</a></li>
          <li><a href="galerie.html">Galerie</a></li>
          <li><a href="Votes.html">Événements</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="landing_page.html">À propos</a></li>

        </ul>
        <a href="#" id="openModal" class="login-btn">Se connecter</a>
      </nav>
    </div>
  </header>
  <main>
    <section class="hero-section">
      <div class="hero-content">
        <img src="images/Design sans titre.png" alt="Logo La Noche" style="max-width: 460px; width: 100%; height: auto; margin-bottom: 2rem; margin-top: 1rem; filter: drop-shadow(0 0 16px #22aaff44);" />
        <p>Le karaoké authentique dans les caves voûtées de Pigalle</p>
        <div class="btn-group">
          <a href="reservation.html" class="btn-red">RÉSERVER MAINTENANT</a>
        </div>
      </div>
    </section>
  </main>
  <footer style="background-color: #10060611; color: #777777; padding: 1rem 2rem; text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    <p style="margin: 0 0 0.5rem 0;">© 2025 La Noche Karaoké Paris. Tous droits réservés</p>
    <p style="margin: 0 0 1rem 0;">42 Rue des Martyrs, 75009 Paris | 01 42 82 42 82</p>
    <a href="contact.html" style="color: #22aaff; text-decoration: none; font-weight: 600; font-size: 0.9rem; border: 1px solid transparent; padding: 6px 14px; border-radius: 15px; background: rgba(34, 170, 255, 0.1); transition: background 0.3s, border-color 0.3s;">Contactez-nous</a>
  </footer>

  <!-- Pop-up connexion / inscription -->
  <div class="modal-bg" id="popupLogin">
    <div class="modal-popup">
      <div class="modal-tabs">
        <button class="tab-btn active" id="tabSignIn" type="button">Déjà inscrit</button>
        <button class="tab-btn" id="tabSignUp" type="button">Nouveau compte</button>
      </div>

      <div id="signInForm">
        <h2 class="modal-title">Connexion</h2>
        <form>
          <label for="login-email">Email</label>
          <input type="email" id="login-email" name="email" autocomplete="email" required />
          <label for="login-password">Mot de passe</label>
          <input type="password" id="login-password" name="password" autocomplete="current-password" required />
          <button type="submit" class="modal-btn-main">SE CONNECTER</button>
        </form>
      </div>

      <div id="signUpForm" style="display:none;">
        <h2 class="modal-title">Nouveau compte</h2>
        <form>
          <label for="newprenom">Prénom</label>
          <input type="text" id="newprenom" name="prenom" autocomplete="given-name" required />
          <label for="newnom">Nom</label>
          <input type="text" id="newnom" name="nom" autocomplete="family-name" required />
          <label for="newemail">Email</label>
          <input type="email" id="newemail" name="email" autocomplete="email" required />
          <label for="newpassword">Mot de passe</label>
          <input type="password" id="newpassword" name="password" autocomplete="new-password" required />
          <button type="submit" class="modal-btn-main">CRÉER LE COMPTE</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    // Fonction pour afficher les messages
    function showMessage(message, isError = false) {
      const messageDiv = document.getElementById('message');
      if (messageDiv) {
        messageDiv.textContent = message;
        messageDiv.style.color = isError ? '#ff4d4d' : '#4CAF50';
        messageDiv.style.display = 'block';
        
        // Masquer le message après 5 secondes
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 5000);
      } else {
        console.log(message);
      }
    }

    // Gestion de la connexion
    async function login(email, password) {
      try {
        const res = await fetch('http://localhost:3000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.error || 'Erreur de connexion');
        }

        const data = await res.json();
        localStorage.setItem('token', data.token);
        showMessage('Connexion réussie !');
        window.location.reload();
        return data.token;
      } catch (err) {
        showMessage('Erreur lors de la connexion : ' + err.message, true);
        return null;
      }
    }

    // Gestion de l'inscription
    async function register(prenom, nom, email, password) {
      try {
        const response = await fetch('http://localhost:3000/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prenom, nom, email, password })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Erreur d\'inscription');
        }

        showMessage('Inscription réussie ! Vous pouvez maintenant vous connecter.');
        // Basculer vers l'onglet de connexion
        document.getElementById('tabSignIn').click();
      } catch (err) {
        showMessage('Erreur lors de l\'inscription : ' + err.message, true);
      }
    }

    // Gestion ouverture/fermeture modale
    document.getElementById("openModal").onclick = function(e) {
      e.preventDefault();
      document.getElementById("popupLogin").style.display = "flex";
    };
    
    document.getElementById("popupLogin").onclick = function(e) {
      if (e.target === this) this.style.display = "none";
    };

    // Gestion des onglets
    const tabSignIn = document.getElementById("tabSignIn");
    const tabSignUp = document.getElementById("tabSignUp");
    const signInForm = document.getElementById("signInForm");
    const signUpForm = document.getElementById("signUpForm");
    
    tabSignIn.onclick = function() {
      tabSignIn.classList.add("active");
      tabSignUp.classList.remove("active");
      signInForm.style.display = "";
      signUpForm.style.display = "none";
    };
    
    tabSignUp.onclick = function() {
      tabSignUp.classList.add("active");
      tabSignIn.classList.remove("active");
      signInForm.style.display = "none";
      signUpForm.style.display = "";
    };

    // Gestion du formulaire de connexion
    document.querySelector('#signInForm form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      await login(email, password);
    });

    // Gestion du formulaire d'inscription
    document.querySelector('#signUpForm form').addEventListener('submit', (e) => {
      e.preventDefault();
      const prenom = document.getElementById('newprenom').value.trim();
      const nom = document.getElementById('newnom').value.trim();
      const email = document.getElementById('newemail').value.trim();
      const password = document.getElementById('newpassword').value;
      register(prenom, nom, email, password);
    });

    // Fonction de déconnexion
    function logout() {
      localStorage.removeItem('token');
      window.location.reload();
    }

    // Vérifier si l'utilisateur est déjà connecté et mettre à jour l'interface
    function updateAuthUI() {
      const token = localStorage.getItem('token');
      const loginBtn = document.getElementById('openModal');
      const userMenu = document.getElementById('userMenu');
      
      if (token && loginBtn) {
        // Remplacer le bouton de connexion par un bouton de déconnexion
        if (loginBtn) {
          loginBtn.outerHTML = `
            <button class="login-btn" id="logoutBtn" style="background-color: #ff4d4d; color: white; padding: 0.5rem 1.2rem; font-weight: 700; border-radius: 25px; border: none; cursor: pointer;" onclick="logout()">
              Déconnexion
            </button>
          `;
        }
      }
    }

    // Initialiser l'interface utilisateur
    updateAuthUI();
  </script>
