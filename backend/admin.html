<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - La Noche Karaok√© Paris 9√®me</title>
    <link rel="stylesheet" href="style.css">
    <meta name="description" content="La Noche - R√©servation en ligne avec base de donn√©es SQLite3 et API Node.js">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">üé§ La Noche</a>
            <ul class="nav-links">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="tarifs.html">Tarifs</a></li>
                <li><a href="reservation.html">R√©servation</a></li>
                <li><a href="boissons.html">Boissons</a></li>
                <li><a href="chansons.html">Chansons</a></li>
                <li><a href="galerie.html">Galerie</a></li>
                <li><a href="evenements.html">√âv√©nements</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section>
            <h1 class="page-title">Administration - R√©servations</h1>

            <div class="admin-stats" style="margin-bottom: 3rem;">
                <div class="grid grid-4">
                    <div class="card" style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                        <div id="totalReservations" style="font-size: 2rem; font-weight: bold; color: var(--gold);">-</div>
                        <div style="color: var(--offwhite);">Total</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚è≥</div>
                        <div id="enAttenteReservations" style="font-size: 2rem; font-weight: bold; color: var(--bordeaux);">-</div>
                        <div style="color: var(--offwhite);">En attente</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úÖ</div>
                        <div id="confirmeesReservations" style="font-size: 2rem; font-weight: bold; color: var(--gold);">-</div>
                        <div style="color: var(--offwhite);">Confirm√©es</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÖ</div>
                        <div id="aujourdhuiReservations" style="font-size: 2rem; font-weight: bold; color: var(--gold);">-</div>
                        <div style="color: var(--offwhite);">Aujourd'hui</div>
                    </div>
                </div>
            </div>

            <div class="admin-controls" style="margin-bottom: 2rem; text-align: center;">
                <button onclick="loadReservations()" class="btn-primary" style="margin-right: 1rem;">üîÑ Actualiser</button>
                <button onclick="exportReservations()" class="btn-secondary">üìä Exporter CSV</button>
            </div>

            <div class="card" style="padding: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 2rem;">üìã Liste des R√©servations</h3>

                <div id="loadingReservations" style="text-align: center; color: var(--gold); display: none;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                    <p>Chargement des r√©servations...</p>
                </div>

                <div id="reservationsContainer">
                    <!-- R√©servations charg√©es ici -->
                </div>
            </div>
        </section>

        <script>
        const API_BASE_URL = 'http://localhost:3001/api';

        // Charger les statistiques
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                const result = await response.json();

                if (result.success) {
                    document.getElementById('totalReservations').textContent = result.data.total || 0;
                    document.getElementById('enAttenteReservations').textContent = result.data.enAttente || 0;
                    document.getElementById('confirmeesReservations').textContent = result.data.confirmees || 0;
                    document.getElementById('aujourdhuiReservations').textContent = result.data.aujourdhui || 0;
                }
            } catch (error) {
                console.error('Erreur chargement stats:', error);
            }
        }

        // Charger les r√©servations
        async function loadReservations() {
            const container = document.getElementById('reservationsContainer');
            const loading = document.getElementById('loadingReservations');

            loading.style.display = 'block';
            container.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/reservations`);
                const result = await response.json();

                loading.style.display = 'none';

                if (result.success && result.data.length > 0) {
                    let html = `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--gold-transparent); color: var(--gold);">
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">ID</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Nom</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Email</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">T√©l√©phone</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Date</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Heure</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Personnes</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Statut</th>
                                    <th style="padding: 1rem; border: 1px solid var(--gold); text-align: left;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>`;

                    result.data.forEach(reservation => {
                        const statutColor = reservation.statut === 'confirmee' ? 'var(--gold)' : 
                                          reservation.statut === 'annulee' ? '#ff6b6b' : 'var(--bordeaux)';

                        html += `
                        <tr style="color: var(--offwhite);">
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.id}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.nom}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.email}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.telephone}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.date_reservation}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.heure_reservation}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">${reservation.nombre_personnes} pers.</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent); color: ${statutColor}; font-weight: bold;">${reservation.statut}</td>
                            <td style="padding: 0.8rem; border: 1px solid var(--gold-transparent);">
                                <button onclick="deleteReservation(${reservation.id})" style="background: #ff6b6b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">‚ùå</button>
                            </td>
                        </tr>`;
                    });

                    html += '</tbody></table></div>';
                    container.innerHTML = html;

                } else {
                    container.innerHTML = '<p style="text-align: center; color: var(--offwhite); padding: 2rem;">Aucune r√©servation trouv√©e.</p>';
                }

            } catch (error) {
                loading.style.display = 'none';
                container.innerHTML = '<p style="text-align: center; color: #ff6b6b; padding: 2rem;">Erreur lors du chargement des r√©servations.</p>';
                console.error('Erreur:', error);
            }
        }

        // Supprimer une r√©servation
        async function deleteReservation(id) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette r√©servation ?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/reservations/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ R√©servation supprim√©e avec succ√®s');
                    loadReservations();
                    loadStats();
                } else {
                    alert('‚ùå Erreur lors de la suppression');
                }

            } catch (error) {
                alert('‚ùå Erreur de connexion');
                console.error('Erreur:', error);
            }
        }

        // Exporter en CSV
        function exportReservations() {
            // Simpler pour le moment
            alert('üí° Fonctionnalit√© d\'export √† impl√©menter');
        }

        // Charger au d√©marrage
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadReservations();
        });
        </script>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <h3>üé§ La Noche</h3>
                <p>Le karaok√© authentique de Pigalle depuis 2015</p>
            </div>

            <div class="footer-links">
                <a href="index.html">Accueil</a>
                <a href="tarifs.html">Tarifs</a> 
                <a href="reservation.html">R√©servation</a>
                <a href="contact.html">Contact</a>
            </div>

            <div class="footer-social">
                <a href="#" aria-label="Facebook">üìò</a>
                <a href="#" aria-label="Instagram">üì∑</a>
                <a href="#" aria-label="Twitter">üê¶</a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 La Noche. Tous droits r√©serv√©s.</p>
            <p>42 Rue des Martyrs, 75009 Paris | 01 42 82 42 82</p>
        </div>
    </footer>
</body>
</html>